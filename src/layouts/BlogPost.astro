---
import FeelbackPulse from "astro-feelback/components/FeelbackPulse.astro";
import FeelbackMessage from "astro-feelback/components/FeelbackMessage.astro";
import { Image } from "astro:assets";
import type { CollectionEntry } from "astro:content";
import ArwesBackground from "../components/ArwesBackground";
import BaseHead from "../components/BaseHead.astro";
import Footer from "../components/Footer.astro";
import FormattedDate from "../components/FormattedDate.astro";
import Header from "../components/Header.astro";
import TagsDisplay from "../components/TagsDisplay.astro";

import "astro-feelback/styles/feelback.css";

const CONTENT_SET_LIKES = "096adebe-eee8-417f-954f-02205c155596";

type Props = CollectionEntry<"blog">["data"];

const {
  title,
  description,
  pubDate,
  updatedDate,
  heroImage,
  tags = [],
} = Astro.props;
---

<html lang="en">
  <head>
    <BaseHead title={title} description={description} />
    <style is:global>
      .feelback-icon svg {
        width: 24px;
        height: 24px;
      }
    </style>
  </head>

  <body>
    <ArwesBackground client:load />
    <div style="position: relative; z-index: 1;">
      <Header />
      <main class="blog-post-main">
        <article>
          <div class="hero-image">
            {
              heroImage && (
                <Image
                  width={1020}
                  height={510}
                  src={heroImage}
                  alt=""
                  class="hero-img"
                />
              )
            }
          </div>
          <div class="prose-container">
            <div class="title-section">
              <div class="date-section">
                <FormattedDate date={pubDate} />
                {
                  updatedDate && (
                    <div class="last-updated-on">
                      <span class="bracket">[</span>
                      Last updated on <FormattedDate date={updatedDate} />
                      <span class="bracket">]</span>
                    </div>
                  )
                }
              </div>
              <h1 class="article-title">
                <span class="title-bracket">&gt;&gt;</span>
                {title}
              </h1>
              <TagsDisplay tags={tags} />
              <hr class="title-divider" />
            </div>
            <slot />
            <hr class="title-divider" />
            <div class="feelback-section">
              Like this post? Show some love:
              <FeelbackPulse
                contentSetId={CONTENT_SET_LIKES}
                preset="heart"
                showCount
              />
            </div>
            <div>
              <FeelbackMessage
                title="Leave a Comment"
                placeholder="Share your thoughts about this post..."
                contentSetId="b0a51407-93f7-4f15-b2d4-fc7120407463"
              />
            </div>
          </div>
        </article>
      </main>
      <Footer />
    </div>
  </body>
</html>

<style>
  .blog-post-main {
    width: 100%;
    max-width: 100%;
    margin: 0;
    padding: 0;
  }

  .hero-image {
    width: 100%;
  }

  .hero-img {
    display: block;
    margin: 0 auto;
    border-radius: 8px;
    border: 2px solid var(--color-border-dim);
    box-shadow: 0 0 30px rgba(0, 217, 255, 0.3);
  }

  .prose-container {
    max-width: 720px;
    width: 100%;
    margin: 0 auto;
    padding: 1rem;
    color: var(--color-text-body);
  }

  .title-section {
    margin-bottom: 2rem;
    padding: 2rem 0;
    text-align: center;
  }

  .date-section {
    margin-bottom: 1rem;
    color: var(--color-text-secondary);
  }

  .last-updated-on {
    font-style: italic;
    margin-top: 0.5rem;
    font-size: 0.9em;
  }

  .bracket {
    color: var(--color-accent);
    margin: 0 0.25rem;
  }

  .article-title {
    margin: 0 0 1rem 0;
    font-size: 2.5rem;
    font-weight: bold;
    line-height: 1.2;
    color: var(--color-text-primary);
    text-shadow: 0 0 15px rgba(0, 217, 255, 0.5);
  }

  .title-bracket {
    color: var(--color-accent);
    margin-right: 0.5rem;
  }

  @media (min-width: 768px) {
    .article-title {
      font-size: 3rem;
    }
  }

  .title-divider {
    border: none;
    height: 1px;
    background: linear-gradient(
      90deg,
      transparent 0%,
      var(--color-border) 50%,
      transparent 100%
    );
    margin: 2rem 0;
  }
</style>
