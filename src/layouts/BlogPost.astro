---
import FeelbackPulse from "astro-feelback/components/FeelbackPulse.astro";
import FeelbackMessage from "astro-feelback/components/FeelbackMessage.astro";
import { Image } from "astro:assets";
import type { CollectionEntry } from "astro:content";
import ArwesBackground from "../components/ArwesBackground";
import BaseHead from "../components/BaseHead.astro";
import Footer from "../components/Footer.astro";
import FormattedDate from "../components/FormattedDate.astro";
import Header from "../components/Header.astro";
import TagsDisplay from "../components/TagsDisplay.astro";
import SocialShare from "../components/SocialShare.astro";

import "astro-feelback/styles/feelback.css";

const CONTENT_SET_LIKES = "096adebe-eee8-417f-954f-02205c155596";

type Props = CollectionEntry<"blog">["data"] & {
  prevPost?: CollectionEntry<"blog"> | null;
  nextPost?: CollectionEntry<"blog"> | null;
};

const {
  title,
  description,
  pubDate,
  updatedDate,
  heroImage,
  tags = [],
  prevPost,
  nextPost,
} = Astro.props;
---

<html lang="en">
  <head>
    <BaseHead title={title} description={description} />
    <style is:global>
      .feelback-icon svg {
        width: 24px;
        height: 24px;
      }
    </style>
  </head>

  <body>
    <ArwesBackground client:load />
    <div style="position: relative; z-index: 1;">
      <Header />
      
      <!-- Sticky Navigation Buttons -->
      <div class="sticky-nav">
        {prevPost && (
          <a 
            href={`/articles/${prevPost.id}/`} 
            class="nav-btn prev-btn"
          >
            <span class="nav-icon">←</span>
            <span class="nav-label">Previous</span>
          </a>
        )}
        {nextPost && (
          <a 
            href={`/articles/${nextPost.id}/`} 
            class="nav-btn next-btn"
          >
            <span class="nav-label">Next</span>
            <span class="nav-icon">→</span>
          </a>
        )}
      </div>

      <main class="blog-post-main">
        <article>
          <div class="hero-image">
            {
              heroImage && (
                <Image
                  width={1020}
                  height={510}
                  src={heroImage}
                  alt=""
                  class="hero-img"
                />
              )
            }
          </div>
          <div class="prose-container">
            <div class="title-section">
              <div class="date-section">
                <FormattedDate date={pubDate} />
                {
                  updatedDate && (
                    <div class="last-updated-on">
                      <span class="bracket">[</span>
                      Last updated on <FormattedDate date={updatedDate} />
                      <span class="bracket">]</span>
                    </div>
                  )
                }
              </div>
              <h1 class="article-title">
                <span class="title-bracket">&gt;&gt;</span>
                {title}
              </h1>
              <TagsDisplay tags={tags} />
              <hr class="title-divider" />
            </div>
            <slot />
            <SocialShare title={title} description={description} />
            <hr class="title-divider" />
            <div class="feelback-section">
              Like this post? Show some love:
              <FeelbackPulse
                contentSetId={CONTENT_SET_LIKES}
                preset="heart"
                showCount
              />
            </div>
          </div>
        </article>
      </main>
      <Footer />
    </div>
  </body>
</html>

<style>
  .blog-post-main {
    width: 100%;
    max-width: 100%;
    margin: 0;
    padding: 0;
  }

  .hero-image {
    width: 100%;
  }

  .hero-img {
    display: block;
    margin: 0 auto;
    border-radius: 8px;
    border: 2px solid var(--color-border-dim);
    box-shadow: 0 0 30px rgba(0, 217, 255, 0.3);
  }

  .prose-container {
    max-width: 720px;
    width: 100%;
    margin: 0 auto;
    padding: 1rem;
    color: var(--color-text-body);
  }

  .title-section {
    margin-bottom: 2rem;
    padding: 2rem 0;
    text-align: center;
  }

  .date-section {
    margin-bottom: 1rem;
    color: var(--color-text-secondary);
  }

  .last-updated-on {
    font-style: italic;
    margin-top: 0.5rem;
    font-size: 0.9em;
  }

  .bracket {
    color: var(--color-accent);
    margin: 0 0.25rem;
  }

  .article-title {
    margin: 0 0 1rem 0;
    font-size: 2.5rem;
    font-weight: bold;
    line-height: 1.2;
    color: var(--color-text-primary);
    text-shadow: 0 0 15px rgba(0, 217, 255, 0.5);
  }

  .title-bracket {
    color: var(--color-accent);
    margin-right: 0.5rem;
  }

  @media (min-width: 768px) {
    .article-title {
      font-size: 3rem;
    }
  }

  .title-divider {
    border: none;
    height: 1px;
    background: linear-gradient(
      90deg,
      transparent 0%,
      var(--color-border) 50%,
      transparent 100%
    );
    margin: 2rem 0;
  }

  /* Sticky Navigation */
  .sticky-nav {
    position: fixed;
    top: 50%;
    left: 0;
    right: 0;
    transform: translateY(-50%);
    z-index: 40;
    pointer-events: none;
    padding: 0 1rem;
    max-width: 1400px;
    margin: 0 auto;
  }

  .nav-btn {
    position: absolute;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border-dim);
    border-radius: 8px;
    color: var(--color-text-secondary);
    text-decoration: none;
    transition: all var(--duration-normal) ease;
    pointer-events: auto;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(10px);
    font-size: 0.9rem;
    font-weight: 500;
  }

  .prev-btn {
    left: 0;
  }

  .next-btn {
    right: 0;
  }

  .nav-btn:hover {
    border-color: var(--color-primary);
    background: var(--color-bg-tertiary);
    box-shadow: 0 0 20px rgba(0, 217, 255, 0.4);
    transform: translateX(0);
  }

  .prev-btn:hover {
    transform: translateX(-4px);
  }

  .next-btn:hover {
    transform: translateX(4px);
  }

  .nav-icon {
    font-size: 1.25rem;
    color: var(--color-accent);
    transition: all var(--duration-normal) ease;
  }

  .nav-btn:hover .nav-icon {
    color: var(--color-primary);
    text-shadow: 0 0 10px rgba(0, 217, 255, 0.6);
  }

  .nav-label {
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  /* Hide on small screens */
  @media (max-width: 1024px) {
    .sticky-nav {
      display: none;
    }
  }

  /* Adjust for medium screens */
  @media (max-width: 1200px) {
    .nav-btn {
      padding: 0.5rem 0.75rem;
    }
    
    .nav-label {
      display: none;
    }
    
    .nav-icon {
      font-size: 1.5rem;
    }
  }
</style>
